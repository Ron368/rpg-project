<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Syntax Slayer — Leaderboard</title>
  <style>
    :root{
      --bg-1:#071126;
      --bg-2:#081928;
      --accent:#56e0ff;
      --muted:#9fbfd8;
      --card:#0f2433cc;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(ellipse at top left, rgba(86,224,255,0.08), transparent 20%), linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#eaf7ff;
      -webkit-font-smoothing:antialiased;
      padding:32px;
      min-height:100vh;
    }

    .container{max-width:1100px;margin:0 auto}

    header.leader-hero{
      display:flex;
      align-items:center;
      gap:20px;
      margin-bottom:18px;
    }
    .logo {
      width:86px;height:86px;border-radius:18px;background:linear-gradient(135deg,var(--accent),#7b61ff);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(0,0,0,0.5);
      font-weight:800;font-size:28px;color:#021018
    }
    .hero-text h1{margin:0;font-size:28px;letter-spacing:0.6px}
    .hero-text p{margin:6px 0 0;color:var(--muted)}

    .board-grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}

    /* Top cards */
    .top-cards{display:flex;flex-direction:column;gap:12px;background:var(--card);padding:14px;border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
    .top-row{display:flex;gap:10px}
    .pod{flex:1;background:linear-gradient(180deg,var(--glass),var(--glass-2));padding:12px;border-radius:10px;display:flex;align-items:center;gap:12px}
    .avatar{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,#fff2,transparent);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
    .pod .meta{flex:1}
    .pod .meta .rank{font-size:12px;color:var(--muted)}
    .pod .meta .points{font-weight:700;font-size:18px;margin-top:4px}

    /* Right panel */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:18px;border-radius:12px}
    .summary-rows{display:flex;gap:10px;align-items:center}
    .stat{flex:1;padding:10px;border-radius:8px;background:rgba(0,0,0,0.12);text-align:center}
    .stat .num{font-size:20px;font-weight:700;color:var(--accent)}
    .controls{display:flex;gap:8px;margin-top:12px}
    .btn{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer}

    /* Table */
    .table-wrap{background:transparent;padding:12px;border-radius:12px}
    table{width:100%;border-collapse:collapse;color:#dff6ff}
    thead th{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.8px;padding:10px;background:transparent}
    tbody tr{border-bottom:1px solid rgba(255,255,255,0.035)}
    td{padding:12px 8px;font-size:14px}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700;background:linear-gradient(90deg,#00d4ff22,#7b61ff22);color:var(--accent);border:1px solid rgba(255,255,255,0.04)}

    .empty{padding:28px;text-align:center;color:var(--muted)}

    footer{margin-top:18px;text-align:center;color:var(--muted)}

    @media (max-width:900px){
      .board-grid{grid-template-columns:1fr;}
      .top-row{flex-direction:row}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="leader-hero">
      <div class="logo">SS</div>
      <div class="hero-text">
        <h1>Syntax Slayer — Leaderboard</h1>
        <p>Track your best rounds, recent plays, and total points earned.</p>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <a class="btn" href="/">Back to Game</a>
      </div>
    </header>

    <div class="board-grid">
      <div>
        <div class="top-cards">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong style="font-size:14px">Top Rounds</strong>
            <small style="color:var(--muted)">By round points</small>
          </div>
          <div class="top-row" id="topRow">
            <!-- top 3 pods inserted here -->
          </div>
          <div class="table-wrap" id="tableWrap">
            <!-- table inserted here -->
          </div>
        </div>
      </div>

      <aside class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-size:12px;color:var(--muted)">Total Points</div>
            <div class="num" id="totalPointsLarge" style="font-size:28px;color:var(--accent);font-weight:800">0</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:12px;color:var(--muted)">Recent Plays</div>
            <div id="recentCount" style="font-weight:700">0</div>
          </div>
        </div>

        <div class="controls">
          <button class="btn" id="btnExport">Export JSON</button>
          <button class="btn" id="btnClear">Clear Leaderboard</button>
        </div>
      </aside>
    </div>

    <footer>
      <small>Leaderboard stored locally in your browser (localStorage). Only visible on this device.</small>
    </footer>
  </div>

  <script>
    function loadData(){
      const total = parseInt(localStorage.getItem('syntax-slayer-points') || '0',10) || 0;
      const raw = localStorage.getItem('syntax-slayer-leaderboard');
      const list = raw ? JSON.parse(raw) : [];
      return { total, list };
    }

    function renderTopPods(list){
      const container = document.getElementById('topRow');
      container.innerHTML = '';
      if (!list || list.length === 0){
        container.innerHTML = '<div class="empty">No rounds yet. Play to appear here.</div>';
        return;
      }

      const top = [...list].sort((a,b)=> (b.points||0)-(a.points||0)).slice(0,3);
      top.forEach((entry, i)=>{
        const pod = document.createElement('div');
        pod.className = 'pod';
        pod.innerHTML = `
          <div class="avatar">#${i+1}</div>
          <div class="meta">
            <div class="rank">${new Date(entry.date).toLocaleString()}</div>
            <div class="points">${entry.points || 0} pts</div>
          </div>
          <div style="text-align:right"><div class="badge">Total ${entry.total||0}</div></div>
        `;
        container.appendChild(pod);
      });
    }

    function renderTable(list){
      const wrap = document.getElementById('tableWrap');
      if (!list || list.length === 0){
        wrap.innerHTML = '<div class="empty">No recent rounds. Play some rounds to populate the leaderboard.</div>';
        return;
      }

      const rows = list.slice(0,50).map((entry, idx)=>{
        const date = new Date(entry.date).toLocaleString();
        const q = entry.question ? entry.question.length > 80 ? entry.question.substring(0,77)+'...' : entry.question : '';
        return `<tr>
          <td style="width:36px">${idx+1}</td>
          <td style="width:160px">${date}</td>
          <td><strong>${entry.points||0}</strong></td>
          <td>${entry.total||0}</td>
          <td style="color:var(--muted)">${q}</td>
        </tr>`;
      }).join('\n');

      wrap.innerHTML = `<table><thead><tr><th>#</th><th>Date</th><th>Round</th><th>Total</th><th>Question</th></tr></thead><tbody>${rows}</tbody></table>`;
    }

    function renderAll(){
      const { total, list } = loadData();
      document.getElementById('totalPointsLarge').textContent = total;
      document.getElementById('recentCount').textContent = (list && list.length) || 0;
      renderTopPods(list);
      renderTable(list);
    }

    document.getElementById('btnExport').addEventListener('click', ()=>{
      const raw = localStorage.getItem('syntax-slayer-leaderboard') || '[]';
      const blob = new Blob([raw], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'syntax-slayer-leaderboard.json';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('btnClear').addEventListener('click', ()=>{
      if (!confirm('Clear local leaderboard? This cannot be undone.')) return;
      localStorage.removeItem('syntax-slayer-leaderboard');
      localStorage.removeItem('syntax-slayer-points');
      renderAll();
    });

    // initial render
    renderAll();
  </script>
</body>
</html>
